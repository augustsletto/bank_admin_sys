{% extends 'baseTemplate.html' %}
{% set active_page = "transfer" %}
{% block title %}Management{% endblock %}


{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<div class="row g-4 mx-2">


    
    <div class="col-3 d-flex">
        <div class="card-border flex-fill p-4 pb-0" style="background-color: #1d1d1d;">
            <div class="row d-flex justify-content-between">
                <div class="col card-title pb-4">Currency </div>
                <div class="col text-end"><i class="bi bi-three-dots py-1 px-2 tiny-buttons rounded"></i></div>
            </div>
            

            <div class="converter mb-4">
                <div class="mb-3">
                  <input type="number" id="amount" class="form_input py-2" placeholder="Enter amount">
                </div>
                
                <div class="row mb-3">
                  <div class="col">
                    <div class="dropdown">
                      <button id="fromCurrencyButton" class="btn dropdown-toggle custom-currency-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="width: 100%; text-align: left; background: #444; color: #fff; border: none;">
                        From Currency
                      </button>
                      <ul id="fromCurrencyMenu" class="dropdown-menu" style="width: 100%; background: #333;">
                        {% for currency in currencies %}
                        <li>
                          <a class="dropdown-item" href="#" data-value="{{ currency }}" style="color: #fff;">{{ currency }}</a>
                        </li>
                        {% endfor %}
                      </ul>
                    </div>
                    <input type="hidden" id="fromCurrency" value="">
                  </div>
                  <div class="col">
                    <div class="dropdown">
                      <button id="toCurrencyButton" class="btn dropdown-toggle custom-currency-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="width: 100%; text-align: left; background: #444; color: #fff; border: none;">
                        To Currency
                      </button>
                      <ul id="toCurrencyMenu" class="dropdown-menu" style="width: 100%; background: #333;">
                        {% for currency in currencies %}
                        <li>
                          <a class="dropdown-item" href="#" data-value="{{ currency }}" style="color: #fff;">{{ currency }}</a>
                        </li>
                        {% endfor %}
                      </ul>
                    </div>
                    <input type="hidden" id="toCurrency" value="">
                  </div>
                </div>
                
             
                <div class="mb-3">
                  <input type="text" id="convertedAmount" class="form_input py-2" placeholder="Converted amount" readonly>
                </div>
                
                
                <button class="exchange-btn mt-0" onclick="convertCurrency()">Exchange Now</button>
                    
                    <div class="number-pad">
                        <button onclick="addNumber(1)">1</button>
                        <button onclick="addNumber(2)">2</button>
                        <button onclick="addNumber(3)">3</button>
                        <button onclick="addNumber(4)">4</button>
                        <button onclick="addNumber(5)">5</button>
                        <button onclick="addNumber(6)">6</button>
                        <button onclick="addNumber(7)">7</button>
                        <button onclick="addNumber(8)">8</button>
                        <button onclick="addNumber(9)">9</button>
                        <button onclick="clearAmount()">C</button>
                        <button onclick="addNumber(0)">0</button>
                        
                    </div>
              </div>
            

        </div>
    </div>
    
    <div class="col-9 d-flex">
        <div class="p-2 card-border flex-fill p-4" style="background-color: #1d1d1d;">
            <div class="row d-flex justify-content-between">
                <div class="col card-title pb-2">Transfer</div>
                <div class="col text-end"><i class="bi bi-search py-1 px-2 tiny-buttons rounded"></i></div>
            </div>
            
            
            <form method="POST" action="{{ url_for('transfer')}}" class="card p-4">
              {{ form.hidden_tag() }}

              <div class="mb-3">
                <label for="sender_account_id" class="form-label">Sender Account</label>
                {{ form.sender_account_id(class="form_control") }}
              </div>

              <div class="mb-3">
                <label for="receiver_account_id" class="form-label">receiver Account</label>
                {{ form.receiver_account_id(class="form_control") }}
              </div>

              
              <div class="mb-3">
                <label for="amount" class="form-label">Amount</label>
                {{ form.amount(class="form_control") }}
              </div>

              <button type="submit" class="btn btn-primary w-100">Transfer</button>



            </form>
            <div class="table-container-small">
              
              <table class="table wealt-table">
                <thead>
                  <tr>
                    <th>Account Id</th>
                    <th>Customer name</th>
                    <th>Account type</th>
                    <th>Balance</th>
                  </tr>
                </thead>
                <tbody>
                  {% for account in accounts %}
                    <tr>
                    <td>{{ account.id }}</td>
                    <td>{{ account.customer.given_name }} {{ account.customer.surname }}</td>
                    <td>{{ account.account_type.value }}</td>
                    <td>${{ "%.2f"|format(account.balance) }}</td>
                </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
                        
         
        </div>
        </div>
    </div>



    
</div>





<script>
    document.addEventListener("DOMContentLoaded", function () {
      // Update the From Currency button and hidden input on selection
      document.querySelectorAll('#fromCurrencyMenu .dropdown-item').forEach(function(item) {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          var selectedCurrency = this.getAttribute("data-value");
          document.getElementById('fromCurrencyButton').textContent = selectedCurrency;
          document.getElementById('fromCurrency').value = selectedCurrency;
        });
      });
      
      // Update the To Currency button and hidden input on selection
      document.querySelectorAll('#toCurrencyMenu .dropdown-item').forEach(function(item) {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          var selectedCurrency = this.getAttribute("data-value");
          document.getElementById('toCurrencyButton').textContent = selectedCurrency;
          document.getElementById('toCurrency').value = selectedCurrency;
        });
      });
    });
  
    // Conversion function that reads the amount and selected currencies
    function convertCurrency() {
      let amount = parseFloat(document.getElementById("amount").value);
      let fromCurrency = document.getElementById("fromCurrency").value;
      let toCurrency = document.getElementById("toCurrency").value;
  
      fetch(`/convert?amount=${amount}&from=${fromCurrency}&to=${toCurrency}`)
        .then(response => response.json())
        .then(data => {
          if (data.converted_amount !== undefined) {
            document.getElementById("convertedAmount").value = data.converted_amount;
          } else {
            alert("Error: " + JSON.stringify(data));
          }
        })
        .catch(error => console.error("Error:", error));
    }
  </script>










{% endblock %}